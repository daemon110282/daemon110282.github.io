# Производительность Performance

- [Производительность Performance](#производительность-performance)
  - [Метрики](#метрики)
    - [Business Metrics](#business-metrics)
    - [Application Metrics](#application-metrics)
    - [System Metrics](#system-metrics)
    - [Client Metrics: Приложение front-end](#client-metrics-приложение-front-end)
    - [Service Metrics: API](#service-metrics-api)
  - [Требования пример](#требования-пример)
  - [TODO merge](#todo-merge)

[Паттерны](../pattern/pattern.perf.md)

  - [Балансировка](../pattern/load.balancing.md)
  - concurrency

## Метрики

- __Client Metrics__ - Данные метрики сконцентрированы на измерении производительности клиентских приложений. 
  - Например, как долго клиентское приложение выполняет действия локально и обрабатывает ответ от серверной части. 
  - Эти метрики покрывают такие данные, как объем используемой памяти и загрузку CPU. На мобильном устройстве высокая загрузка CPU и частое использование сети может привести к уменьшению срока службы батареи, а использование слишком большого объема памяти вообще может помешать приложению запуститься.
- __Business Metrics__ - Сюда включаются данные, определяющие бизнес-процессы. Они касаются деятельности конечных пользователей. Эти показатели должны включать ключевые бизнес-операции, которые выполняет система
- __Application Metrics__ - Данные метрики сосредоточены на измерении активности и производительности прикладного уровня (исходный код приложения, фреймворк, среда исполнения, например .NET Framework, ASP.NET, CLR, и т.п.). 
  - Цель этих метрик – помочь вам исследователь поток выполнения вашего приложения при большом количестве параллельных запросов, проанализировать потребляемые ресурсы и оценить вероятность проблем с производительностью
- __System Metrics__ - Это данные о производительности низкого уровня (уровень базовой инфраструктуры). Они обычно нацелены на ключевые показатели эффективности, связанные с __памятью, сетевой утилизацией, активностью диска, использованием процессора__
- __Service Metrics__ - Сюда относятся данные, связанные с производительностью внешних сервисов, таких как Azure Storage, инфраструктурой обмена сообщений, внешним кэшем, БД и другими внешними сервисами, которые ваше приложение может использовать. Эти данные не отражают чистую производительность внешних сервисов, а всего лишь содержат информацию об исполнении запросов, которые ваша система им отправляет.

### Business Metrics

- Макс пользователей
- Как долго система выполняет операцию? (время отклика/задержка)
- Максимальное время загрузки страницы (300мс отлично)

### Application Metrics

- Сколько операций может выполнить система за определенный период времени? (пропускная способность)
- Сколько операций могут быть выполнены одновременно? (параллелизм)
- Сколько резервной мощности требуется системе для обеспечения роста нагрузки? (запас ресурсов)
- Сколько исключений система генерит под нагрузкой? (частота ошибок)

### System Metrics

- CPU User time
- CPU System time (Может  показывать на неэффективный ввод-вывод, т.е. слишком большое количество мелких операций)
- HDD Number of reads
- HDD Number of writes
- HDD bytes readed
- HDD bytes written
- Network Number of reads
- Network number of writes
- Network bytes readed
- Network bytes written
- RAM Private space used by application
- RAM Shared space used by application
- RAM Number of page faults (насколько локализованы данные приложения в памяти?)

### Client Metrics: Приложение front-end

- Google [Web Vitals](https://web.dev/i18n/en/vitals/)
  - [Core](https://timeweb.com/ru/community/articles/core-web-vitals) __75-й процентиль__
    - LCP - насколько быстро происходит скорость загрузки страницы - <2.5-4c 
    - FID - как быстро происходит взаимодействие с сайтом - <1-3c
    - CLS - корректно ли работают в совокупности все элементы - <0.1-0.25
  - [Дополнительно](https://web.dev/vitals/?utm_source=pocket_saves#drugie-pokazateli-web-vitals)
    - Time to First Byte (TTFB) - Время до первого байта 
    - First Contentful Paint (FCP) - Первая отрисовка контента
    - Total Blocking Time (TBT) - Общее время блокировки 
    - Time to Interactive (TTI) - Время до интерактивности

### Service Metrics: API

- Latency Задержка - __0,1-1 сек__.
![scheme](https://blog.hubspot.com/hs-fs/hubfs/Google%20Drive%20Integration/API%20Response%20Time%2c%20Explained%20in%201000%20Words%20or%20Less-1.jpeg?width=650&name=API%20Response%20Time%2c%20Explained%20in%201000%20Words%20or%20Less-1.jpeg)
  - API [Benchmark](https://github.com/tsenart/vegeta) Latency
- [Response Time Время отлика](https://blog.hubspot.com/website/api-response-time) - __[1-2 сек](https://sematext.com/glossary/response-time/)__:
  - DNS Lookup Time  
  - Authentication and connection time
  - Redirect Time 
  - Time to First Byte
  - Time to Last byte
  - Benchmark 
    - [JMeter](https://www.guru99.com/response-time-testing.html)

## Требования пример

- какой объем памяти выделен будет на работу приложения на хостинге?
- какой объем памяти допустимо использовать на ПК клиента для отображения отчета (максимум как мы понимаем 1ГБ- память на работу ОС XP, т.е. около 800Мб)?
- какая макс скорость канала будет от ПК пользователя до веб-сервера?
- какое время ожидания отчета в принципе допустимо для "очень большого отчета"? предлагаю определиться именно с параметрами "очень большого отчета"
- Здесь необходимо сначала дать определения большого и не большого отчета, а то слишком субъективные оценки.
- Обычный Текстовый 150 строк * 12 столбцов 12 сек.
- Большой Текстовый отчет за 3 года не более 2 мин. (ориентировочно 20000 строк*15 столбцов)
- Обычный Числовой/Графический 1 минута 3-4 группировки 200 строк * 100 столбоцов
- Максимальный Числовой/Графический максимальная скорость построения отчета – 2 минуты.

## TODO merge

Характеристика - Единицы измерения

- Сколько операций может выполнить система за определенный период времени? (пропускная способность)
- Сколько операций могут быть выполнены одновременно? (параллелизм)
- Как долго система выполняет операцию? (время отклика/задержка)
- Сколько резервной мощности требуется системе для обеспечения роста нагрузки? (запас ресурсов)
- Сколько исключений система генерит под нагрузкой? (частота ошибок)
- Макс пользователей
- Время загрузки страницы (<=300мс отлично)

- Нагрузка на CPU - Процент
- Использование физической/виртуальной памяти	- Байты, килобайты, мегабайты, гигабайты
- Время выполнения среднее\макс для 90% запросов- Миллисекунды
- Сетевые операции, канал забит -	Количество, частота следования в секунду, объем трафика bandwidth, какие урлы сколько трафика генерируют, трафик на сетевых интерфейсах
- Дисковые операции СХД	- Количество, частота следования в секунду
- Время отклика\задержки Latency - Миллисекунды
- параметры [виртуалки VMWare](https://habrahabr.ru/post/259087/)
- redis память много, операции чтения
- [балансировщик](../pattern/load.balancing.md) прокси, nginx, netscaler - как балансировка на ноды работает, время ответ нод балансировщику
- Исключительные ситуации errors, HTTP Error 503.2 — Service Unavailable - Количество, частота следования в секунду
- Обращения к базе данных -	Количество обращений, частота следования в секунду
- "Сколько операций может выполнить система за определенный период времени? (пропускная способность)
- "Сколько операций могут быть выполнены одновременно? (параллелизм)
- Макс пользователей
- Число вызовов в сутки / в ЧПН
- Объем запроса, Объем ответа
- Попадания в кеш	Количество, частота попаданий в секунду
- Ошибки обращений к страницам диска - Количество, частота следования в секунду
- Конкуренция - Количество, частота следования в секунду
- Выделение блоков памяти - Количество байтов, количество объектов, частота следования в секунду
- Сборка мусора - Количество, частота следования в секунду, продолжительность, % от общего времени выполнения
- Время запуска - Миллисекунды
- Сколько резервной мощности требуется системе для обеспечения роста нагрузки? (запас ресурсов)
- Сколько исключений система генерит под нагрузкой? (частота ошибок)

TODO
- [UMP](https://airtable.com/embed/shrj9QkstRkVlFW0i/tblzJXJYUlj4aCHaJ)
- http://sixrevisions.com/web-performance/improve-website-speed-02/
