# Синхронизация (репликация) данных

- [Синхронизация (репликация) данных](#синхронизация-репликация-данных)
  - [Зачем](#зачем)
  - [Паттерны](#паттерны)
    - [CDC vs ETL](#cdc-vs-etl)
  - [Технологии](#технологии)

## Зачем

__Репликация__ представляет собой набор технологий копирования и распространения данных и объектов баз данных между базами данных, а также __синхронизации__ баз данных для поддержания согласованности.

Сравнение [видов репликации данных](https://habr.com/ru/articles/514500/)

- __Блочная репликация__ - на уровне системы хранения данных
  - имеет смысл, когда других способов репликации нет, для баз данных её лучше не использовать.
- __Физическая репликация__ - хороша, когда требуется обеспечение отказоустойчивости инфраструктуры или перенос части читающих приложений на реплики
  - Репликация __транзакций СУБД__
    - [mssql](https://learn.microsoft.com/ru-ru/sql/relational-databases/replication/replication-backward-compatibility?view=sql-server-ver15) Log shipping/Always On
    - pgsql Log shipping/Streaming replication
  - Репликация данных __Key-value__ - redis
- __Логическая репликация__ - все изменения в базе данных происходят в результате вызовов её API – например, в результате выполнения SQL-запросов.
  - подходит для обеспечения отказоустойчивости только в том случае, если приложение знает об этой репликации и умеет в случае аварии ждать синхронизации реплик.
  - идеальна для всевозможных отчётных баз
  - Платформы [__CDC__](../system.class/cdc.md) хороши, если у вас большое количество реплицируемых баз и/или есть необходимость сложных преобразований данных.
  - __Репликация триггерами__ имеет смысл в том случае, если база сильно нагружена, а реплицировать нужно крайне ограниченное количество информации.
    - Минусы: Потребуется изменения в монолите
  - Разработка __прикладной репликации__ оправдана только в случае разработки собственной платформы или фреймворка.

## Паттерны

- __Master-slave__ replica
  - Log shipping
  - Always On
- [ETL](ETL.md)
- [ELT](ELT.md)
- [CDC](../system.class/cdc.md)

С ростом данных наблюдается изменение парадигмы:

- Значительный рост данных
- Код летит к данным
- Использование специализированных сервисов (CDC)
- Изменение парадигмы ETL на ELT
- Усложнение архитектуры для обработки данных
- Линейная масштабируемость

### CDC vs ETL

CDC и ETL являются двумя разными подходами к обработке данных, отличия:

- Цель
   - CDC: Целью CDC является __захватывать и реплицировать изменения, происходящие в реальном времени в исходных базах данных__, чтобы другие системы могли использовать эти обновленные данные.
   - ETL: Цель ETL состоит в __извлечении данных из различных источников__, их преобразовании и загрузке в целевую систему данных для __анализа или хранения__.
- Временная задержка
   - CDC: CDC обрабатывает изменения в режиме __близком к реальному времени__, что позволяет быстро обновлять данные в целевых системах.
   - ETL: ETL выполняет процесс __пакетно, обычно с фиксированной периодичностью__ (например, ежедневно или ежечасно), поэтому между изменениями и их загрузкой может быть __некоторая задержка__.
- Объем данных
   - CDC: CDC обычно работает только с __изменениями данных__, поэтому объем передаваемых данных может быть гораздо меньше по сравнению с полным набором данных.
   - ETL: В процессе ETL __извлекаются и загружаются все данные, которые должны быть обработаны__ в процессе трансформации, даже если они не были изменены. Поэтому объем данных, передаваемых в процессе ETL, может быть значительно больше.

## Технологии

- Commercial
  - Консольная [gsqlcmd](https://www.savetodb.ru/gsqlcmd/synchronizing-data.htm)
- Free
  - [Debezium](../../technology/cdc/debezium.md)
