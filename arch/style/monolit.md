# Монолитная архитектура

## Зачем

- MVP модульный монолит, который затем можно разделить на сервисы в [MSA](msa.md)

## Плюсы и минусы

[Критерии](../arch.criteria.md)

Плюсы:

- Mvp
- Межмодульный рефакторинг
- Согласованность
- Скорость реализации
- Дешевле инфраструктура, реализация
- Приступая к созданию приложения, нужно изначально придерживаться единой архитектуры — по причине её простоты. В то же время нужно стараться создавать его как можно более модульным, чтобы каждый компонент легко переносился в отдельный микросервис

Минусы:

- Регресс
- Долго деплоить и откатывать
- Высокая связность - решение модульный монолит, [DDD](../pattern/ddd.md)
- проблема трех монолитов:
  - монолита приложений
  - интеграционного монолита
  - монолита данных
- наличие единой точки отказа (в случае сбоя в одном из модулей приложения отказывает все приложение и останавливается работа всех сотрудников, работающих с этим приложением);
- сложность в обеспечении требуемого качества разрабатываемого продукта, необходимость проведения объемного регрессионного тестирования;
- одна монолитная команда, расширять которую нецелесообразно, так как это не ускорит и не облегчит процесс разработки
- редкие релизы и множество внутренних заказчиков в организации со своими приоритетными задачами, которым приходится выстраиваться в очередь для включения в релиз; растет как негатив со стороны заказчика, так и напряжение со стороны разработки
- невозможность использования различных технологических стеков (а это становится все более важным в гибридных ИТ-средах). Приходится создавать и запускать целое приложение с одними и теми же языками программирования, инструментами и платформами по причине, что «так уже сделано». Да и в самом приложении обновление текущей библиотеки или переход на новую превращается в нетривиальную и высокорисковую задачу;
- сложность в масштабировании.

### Проблема монолита данных

Связана с использованием централизованного корпоративного хранилища данных (Enterprise Data Warehouse, EDW)

- Решения с использованием EDW дорогие
- они содержат данные в каноническом формате, который в силу специфических знаний поддерживает и понимает лишь одна команда специалистов, которая обслуживает всех.
- Данные в EDW поступают из различных источников. Команда EDW выверяет их и преобразовывает в канонический формат, который должен удовлетворить потребности различных групп потребителей внутри организации, а команда загружена.
- К тому же данные, преобразованные в некий канонический формат не могут быть удобны всем и всегда. Итог — требуется слишком много времени на выполнение работы с данными.

## Паттерны

### Распила монолита

- Что [вынести в первую очередь](http://agilemindset.ru/от-монолита-к-микросервисам-в-разумно/) в сервис\модуль, а что можно оставить?
  - Бизнес-критичность
  - Интенсивность изменений
  - Инновационность
  - Объем транзакций (обращений)  
  - Уровень зависимостей
  - Утилизация ресурсов
  - Сложность сервиса  
- Извлечение сервисов 
  - нужно решить, как разбить __доменную модель монолита на отдельные модели__, одна из которых будет принадлежать сервису. 
  - Для вынесения функциональности придется разорвать зависимости
    - объектные ссылки, и, возможно, __разделить существующие классы__
    - модифицировать __структуру базы данных__
      - __методики рефакторинга__ схемы базы данных
        - рефакторинг типа «разделение таблицы» (split table), который разбивает одну таблицу на две или больше
  - имеет смысл извлечь сервис, __функции, которого постоянно эволюционируют и имеют критическое значение с точки зрения бизнеса__. Если извлечение не приносит существенной выгоды, не стоит тратить на него время.
  - при извлечении сервиса вы разделяете то, что прежде было ACID-транзакциями. Вы должны внимательно __следить за сохранением согласованности__, для этого иногда применяются повествования.
  - Есть три причины, почему __извлечение сервиса может быть полезным__.
    - __Ускорение разработки__. Если согласно плану какая-то часть вашего приложения будет активно развиваться на протяжении следующего года, разработку можно ускорить путем извлечения ее в сервис.
    - Решение проблем с __производительностью, масштабируемостью и надежностью__. Если определенная часть вашего приложения ненадежна или имеет проблемы с производительностью или масштабируемостью, будет полезно преобразовать ее в сервис.
    - Возможность извлечь какие-то другие сервисы. Иногда из-за __зависимостей между модулями__ извлечение одного сервиса упрощает извлечение другого.
- Модульный монолит
  - Изоляция модулей
  - Не обязательно обмен __доменными событиями__ между модулями (на следующей фазе)
  - Отдельные схемы БД
  - Сохраняем БД транзакции и ссылки между таблицами

### Ускорение монолита

- CQRS
- Отдельный сервис

## Антипаттерны

- Распределенный монолит — набор связанных между собой сервисов, которые необходимо развертывать вместе.
  - Присущи недостатки как монолитной, так и [микросервисной архитектуры](msa.md).
  - Признаки «монолитного ада»
    - Сложность продукта подавляет разработчиков
    - Разработка идет медленно
    - Путь от коммита до развертывания долог и сложен
    - Масштабирование затруднено
    - Сопровождение и изменение монолитного кода затруднено
    - Продукт привязан к непрерывно устаревающему технологическому стеку
