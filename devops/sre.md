# Site Reliability Engineering (SRE) Надежность

- [Site Reliability Engineering (SRE) Надежность](#site-reliability-engineering-sre-надежность)
  - [Зачем](#зачем)
  - [ИТ услуга](#ит-услуга)
  - [SLI](#sli)
  - [Бюджет ошибок](#бюджет-ошибок)
  - [Оповещения](#оповещения)
  - [Технологии](#технологии)

Обеспечение эксплуатационной __надежности системы__, набор инженерных практик, поддерживающих надежную и __безотказную работу__ приложений в настоящем и будущем, с учетом __требуемой масштабируемости__ и внезапных форс-мажоров.

## Зачем

- Цель инженера по SRE — обеспечить __надёжную работу системы__
- Определяют, что такое [надёжность Reliability системы](../arch/arch.ability.md), договариваются о показателях и вырабатывают стандарты действий в случае проблем
  - стабильность [resilience](../arch/ability/resilience.md)
  - доступность [availability](../arch/ability/availability.md)
- Показатели
  - __SLI__ - Service Level Indicator - индикаторы уровня обслуживания - __метрики__
  - доступности вырабатываются вместе с продакт-оунером и закрепляются в соглашении о __целевом уровне__ обслуживания (метрик) — __Service-Level Objective (SLO)__ по определенным SLI  
  - Service Level Agreement (__SLA__) - обязанности компании перед потребителями закрепляются. Это соглашение описывает работоспособность всего сервиса и штрафы за превышение времени простоя или другие нарушения
    - описывает ИТ-услугу
    - документирует целевые показатели качества услуги
    - указывает зоны ответственности сторон
    - заключается между Бизнес-владельцем и поставщиком ИТ-услуги

Надежность зависит от частоты и продолжительности __простоев__. [Она измеряется](https://habr.com/ru/companies/itsumma/articles/435662/) через:

- Частоту простоя, или обратную от нее: __MTTF (mean time to failure, среднее время безотказной работы)__
- Продолжительность простоя, __MTTR (mean time to repair, среднее время восстановления)__. Продолжительность простоя определяется временем пользователя: от начала неисправности до возобновления [нормальной работы сервиса](https://habr.com/ru/companies/slurm/articles/525176/).
  - Observability напрямую связана с MTTR. __Чем выше Observability сервиса, тем проще определить ошибку__, исправить и автоматизировать, и тем ниже MTTR.
- Надежность определяется как MTTF/(MTTF+MTTR)

Надёжность можно определять по-разному:

- Сервер AWS считается недоступным только в случае, если за __пять минут не дает никаких ответов на запросы, кроме 500 или 503__. Эти коды ответов обозначают две ошибки: Internal Server Error и Service Unavailable. Все остальные ответы сервера не учитываются при расчёте надёжности.
  - в Amazon успешен только один запрос в 5 минут, по их мнению, это 100%-я доступность!
  - иначе: у вас могут быть до 21 минуты полной деградации, и неограниченное число частичных деградаций.
  - Амазон не нарушит свои условия о 99,95% доступности. Или в крайнем случае - 8640 успешных запросов (по 1му раз в 5 минут) и неограниченное число неуспешных.

## ИТ услуга

- ИТ-услуга - услуга, предоставляемая поставщиком ИТ-услуг. ИТ-услуга включает в себя информационные технологии, процессы и людей. ИТ-услуга, ориентированная на Заказчика, непосредственно поддерживает бизнес-процессы одного или более Заказчиков.
- Бизнес-владелец - это основной заказчик услуги со стороны Бизнеса, использующий ее ценность для получения конечного результата.
- ИТ-владелец - это лицо, ответственное за управление ИТ-услугой в течение ее жизненного цикла, начиная с проектирования и заканчивая выводом из эксплуатации.
- Пользователь - лицо, использующее ИТ-услугу для выполнения конкретной функции или получения результатов ее функционирования.
- Операция по ИТ-услуге - любая предопределенная деятельность или транзакция

Метрики оценки качества ИТ-сервиса:

- доступность (availability);
- производительность (performance);
- надежность (reliability);
- сопровождаемость (maintainability);
- обслуживаемость (serviceability);
- безопасность (security).

## SLI

Что мониторить:

- Client-side monitoring (Sentry и тп): Error, Performance
- [Network monitoring](https://cloud.google.com/blog/topics/partners/using-sentry-to-monitor-web-and-mobile-apps): Latency, Throughput, Utilization
  - CDN
  - Load Balancer
  - Router
  - DNS
  - VPCs
- Server-side [monitoring](../arch/ability/performance.metric.md)
  - system
  - application

## Бюджет ошибок

Бюджет ошибок — это допустимое количество ошибок за выбранный период. Мы считаем его, чтобы измерить надёжность приложения, так как отдельные метрики не дают полной картины.

Наш бюджет ошибок — это ситуации, когда микросервис нарушает нефункциональные требования: отдаёт ответ с одним из кодов (400, 500, 503, 504) или отвечает слишком медленно (Latency 100 мс).

Что даёт расчёт бюджета ошибок?

- Микросервис становится предсказуемым. Например, если указать, что микросервис ответит за 300 мс в 99,9% случаев, то все прочие подключившиеся микросервисы будут ожидать ответ за это время.
- Появляется простор для манёвров. Разработчики могут экспериментировать в рамках бюджета ошибок без риска положить сервис.

## Оповещения

- [Бот, действия, ответственные](https://habr.com/ru/companies/oleg-bunin/articles/481874/)

## Технологии

- [Prometheus + Grafana. Настраиваем 4 golden signals](https://www.youtube.com/watch?v=Q_fKb0nrfCg&ab_channel=Слёрм)
  - [Demo project](https://github.com/s-buhar0v/4-golden-signals-demo)
- Стабильность [Sentry](https://vc.ru/dev/833250-kak-s-pomoshchyu-sentry-nahodit-i-bystro-ustranyat-oshibki)